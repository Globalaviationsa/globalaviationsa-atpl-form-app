<!DOCTYPE html>
<html>
<head>
    <title>ATPL Application Form September 2025</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: auto; }
        form { display: flex; flex-direction: column; }
        label { margin-top: 10px; }
        input { padding: 8px; font-size: 14px; }
        button { margin-top: 20px; margin-bottom: 40px; padding: 10px; font-size: 16px; background: darkred; color: white; border: none; border-radius: 8px; cursor: pointer; transition: background 0.3s ease;}
        button:hover { background: firebrick; }
    </style>
</head>
<body>

    <!-- Logo -->
    <div style="text-align: center; margin: 40px 0 20px 0;">
        <img src="{{ url_for('static', filename='logo.png') }}" 
             alt="Global Aviation Logo" 
             style="max-width: 310px; height: auto; margin-bottom: 15px;">
    </div>

    <h1 style="text-align: center; color: black; margin-bottom: 5px;">
    ATPL Theory Exams Application Form
</h1>
<p style="text-align: center; font-style: italic; font-weight: bold; color: gray; margin-bottom: 20px;">
    HCAA PEL-FCL-930 Generator
</p>
    <form method="post">

    <p class="instructions" style="margin-top: 20px;">Please select your class from the list below.</p>

    <select name="class_selection" id="class_selection" required 
            style="margin-top: 5px; padding: 8px; font-size: 14px; width: 100%;">
        <option value="">-- Please choose --</option>
        <option value="Feb_2023">February 2023</option>
        <option value="Jun_2023">June 2023</option>
        <option value="Oct_2023">October 2023</option>
        <option value="Feb_2024">February 2024</option>
        <option value="Jun_2024">June 2024</option>
        <option value="Oct_2024">October 2024</option>
        <option value="Feb_2025">February 2025</option>
        <option value="Mar_A3_2025">March 2025 Aegean Airlines</option>
        <option value="Jun_2025">June 2025</option>
    </select>

        <h3 style="margin-top: 40px; color: darkred;">1. Personal Details</h3>
        <p class="instructions" style="margin-top: 0;">Please complete all fields in BLOCK CAPITALS.</p>

        <label>Surname</label>
        <input type="text" name="surname" required>

        <label>First Name</label>
        <input type="text" name="firstname" required>

        <label>Title</label>
        <input type="text" name="title" required>

        <label>Date of Birth</label>
        <input type="date" name="dob" required>

        <label>Nationality</label>
        <input type="text" name="nationality" required>

	<label>Place of Birth (Town)</label>
	<input type="text" name="birthplace_town" required>

	<label>Place of Birth (Country)</label>
	<input type="text" name="birthplace_country" required>

        <label>Address</label>
        <input type="text" name="address" required>

        <label>Postcode</label>
        <input type="text" name="postcode" required>

        <label>Phone</label>
        <input type="text" name="phone" required>

        <label>Mobile</label>
        <input type="text" name="mobile" required>

        <label>Email</label>
        <input type="email" name="email" required>
	
        <h3 style="margin-top: 40px; color: darkred;">4. PART-FCL ATPL Examinations</h3>
        <p class="instructions" style="margin-top: 0;">Please select the subjects you wish to be examined at (select Attempt 1 if this is your 1st Attempt, Attempt 2 if this is your 2nd Attempt etc). If you have already passed any subject(s), please insert the date you have passed them.</p>

    <h3>Air Law</h3>
	<label><input type="checkbox" name="airlaw_attempt1"> Attempt 1</label>
	<label><input type="checkbox" name="airlaw_attempt2"> Attempt 2</label>
	<label><input type="checkbox" name="airlaw_attempt3"> Attempt 3</label>
	<label><input type="checkbox" name="airlaw_attempt4"> Attempt 4</label>
	<br>
	<label>Date Passed</label>
	<input type="date" name="airlaw_date">

    <h3>Aircraft General Knowledge_Airframe/Systems/Powerplant</h3>
	<label><input type="checkbox" name="agk_asp_attempt1"> Attempt 1</label>
	<label><input type="checkbox" name="agk_asp_attempt2"> Attempt 2</label>
	<label><input type="checkbox" name="agk_asp_attempt3"> Attempt 3</label>
	<label><input type="checkbox" name="agk_asp_attempt4"> Attempt 4</label>
	<br>
	<label>Date Passed</label>
	<input type="date" name="agk_asp_date">

    <h3>Aircraft General Knowledge_Instrumentation</h3>
	<label><input type="checkbox" name="agk_i_attempt1"> Attempt 1</label>
	<label><input type="checkbox" name="agk_i_attempt2"> Attempt 2</label>
	<label><input type="checkbox" name="agk_i_attempt3"> Attempt 3</label>
	<label><input type="checkbox" name="agk_i_attempt4"> Attempt 4</label>
	<br>
	<label>Date Passed</label>
	<input type="date" name="agk_i_date">

    <h3>Mass and Balance</h3>
	<label><input type="checkbox" name="mb_attempt1"> Attempt 1</label>
	<label><input type="checkbox" name="mb_attempt2"> Attempt 2</label>
	<label><input type="checkbox" name="mb_attempt3"> Attempt 3</label>
	<label><input type="checkbox" name="mb_attempt4"> Attempt 4</label>
	<br>
	<label>Date Passed</label>
	<input type="date" name="mb_date">

    <h3>Performance</h3>
	<label><input type="checkbox" name="perf_attempt1"> Attempt 1</label>
	<label><input type="checkbox" name="perf_attempt2"> Attempt 2</label>
	<label><input type="checkbox" name="perf_attempt3"> Attempt 3</label>
	<label><input type="checkbox" name="perf_attempt4"> Attempt 4</label>
	<br>
	<label>Date Passed</label>
	<input type="date" name="perf_date">

    <h3>Flight Planning and Monitoring</h3>
	<label><input type="checkbox" name="fpm_attempt1"> Attempt 1</label>
	<label><input type="checkbox" name="fpm_attempt2"> Attempt 2</label>
	<label><input type="checkbox" name="fpm_attempt3"> Attempt 3</label>
	<label><input type="checkbox" name="fpm_attempt4"> Attempt 4</label>
	<br>
	<label>Date Passed</label>
	<input type="date" name="fpm_date">

    <h3>Human Performance and Limitations</h3>
	<label><input type="checkbox" name="hpl_attempt1"> Attempt 1</label>
	<label><input type="checkbox" name="hpl_attempt2"> Attempt 2</label>
	<label><input type="checkbox" name="hpl_attempt3"> Attempt 3</label>
	<label><input type="checkbox" name="hpl_attempt4"> Attempt 4</label>
	<br>
	<label>Date Passed</label>
	<input type="date" name="hpl_date">

    <h3>Meteorology</h3>
	<label><input type="checkbox" name="met_attempt1"> Attempt 1</label>
	<label><input type="checkbox" name="met_attempt2"> Attempt 2</label>
	<label><input type="checkbox" name="met_attempt3"> Attempt 3</label>
	<label><input type="checkbox" name="met_attempt4"> Attempt 4</label>
	<br>
	<label>Date Passed</label>
	<input type="date" name="met_date">

    <h3>General Navigation</h3>
	<label><input type="checkbox" name="gnav_attempt1"> Attempt 1</label>
	<label><input type="checkbox" name="gnav_attempt2"> Attempt 2</label>
	<label><input type="checkbox" name="gnav_attempt3"> Attempt 3</label>
	<label><input type="checkbox" name="gnav_attempt4"> Attempt 4</label>
	<br>
	<label>Date Passed</label>
	<input type="date" name="gnav_date">

    <h3>Radio Navigation</h3>
	<label><input type="checkbox" name="rnav_attempt1"> Attempt 1</label>
	<label><input type="checkbox" name="rnav_attempt2"> Attempt 2</label>
	<label><input type="checkbox" name="rnav_attempt3"> Attempt 3</label>
	<label><input type="checkbox" name="rnav_attempt4"> Attempt 4</label>
	<br>
	<label>Date Passed</label>
	<input type="date" name="rnav_date">

    <h3>Operational Procedures</h3>
	<label><input type="checkbox" name="ops_attempt1"> Attempt 1</label>
	<label><input type="checkbox" name="ops_attempt2"> Attempt 2</label>
	<label><input type="checkbox" name="ops_attempt3"> Attempt 3</label>
	<label><input type="checkbox" name="ops_attempt4"> Attempt 4</label>
	<br>
	<label>Date Passed</label>
	<input type="date" name="ops_date">

    <h3>Principles of Flight</h3>
	<label><input type="checkbox" name="pof_attempt1"> Attempt 1</label>
	<label><input type="checkbox" name="pof_attempt2"> Attempt 2</label>
	<label><input type="checkbox" name="pof_attempt3"> Attempt 3</label>
	<label><input type="checkbox" name="pof_attempt4"> Attempt 4</label>
	<br>
	<label>Date Passed</label>
	<input type="date" name="pof_date">

    <h3>Communications</h3>
	<label><input type="checkbox" name="comm_attempt1"> Attempt 1</label>
	<label><input type="checkbox" name="comm_attempt2"> Attempt 2</label>
	<label><input type="checkbox" name="comm_attempt3"> Attempt 3</label>
	<label><input type="checkbox" name="comm_attempt4"> Attempt 4</label>
	<br>
	<label>Date Passed</label>
	<input type="date" name="comm_date">

    <h3>Total Number of Examinations Applied For</h3>
	<input type="number" name="total_exams" id="total_exams" min="0" max="13" readonly>

    <h3 style="margin-top: 40px; color: darkred;">7. Declaration</h3>
        <p class="instructions" style="margin-top: 0;">Please sign by entering your full name.</p>

       <label>Signature (Type your full name)</label>
       <input type="text" name="declaration_signature" required>

       <button type="submit">Submit</button>
    </form>

<script>
/* Subjects: [form field prefix, nice label] */
const subjects = [
  ["airlaw","Air Law"],
  ["agk_asp","AGK – Airframe/Systems/Powerplant"],
  ["agk_i","AGK – Instrumentation"],
  ["mb","Mass & Balance"],
  ["perf","Performance"],
  ["fpm","Flight Planning & Monitoring"],
  ["hpl","Human Performance & Limitations"],
  ["met","Meteorology"],
  ["gnav","General Navigation"],
  ["rnav","Radio Navigation"],
  ["ops","Operational Procedures"],
  ["pof","Principles of Flight"],
  ["comm","Communications"]
];

/* Disable/enable date field live when attempts change */
function setupAttemptDateRules(prefix) {
  const cbs = Array.from(document.querySelectorAll(
    `input[name='${prefix}_attempt1'], input[name='${prefix}_attempt2'], input[name='${prefix}_attempt3'], input[name='${prefix}_attempt4']`
  ));
  const date = document.querySelector(`input[name='${prefix}_date']`);
  if (!date) return;

  const update = () => {
    const anyChecked = cbs.some(cb => cb.checked);
    if (anyChecked) {
      date.value = "";
      date.disabled = true;
      date.title = "Disabled because an Attempt is ticked";
    } else {
      date.disabled = false;
      date.title = "";
    }
  };

  cbs.forEach(cb => cb.addEventListener("change", update));
  update(); // initial state
}

/* Attach live rules for all subjects */
subjects.forEach(([key]) => setupAttemptDateRules(key));

/* Final submission validation */
document.querySelector("form").addEventListener("submit", function (event) {
  for (const [key, label] of subjects) {
    const attempts = Array.from(document.querySelectorAll(
      `input[name='${key}_attempt1'], input[name='${key}_attempt2'], input[name='${key}_attempt3'], input[name='${key}_attempt4']`
    ));
    const dateField = document.querySelector(`input[name='${key}_date']`);

    const checkedCount = attempts.filter(a => a.checked).length;

    // Rule A: only one Attempt
    if (checkedCount > 1) {
      alert(`❌ ${label}: Please tick only ONE Attempt box.`);
      event.preventDefault();
      return;
    }

    // Rule B: if any Attempt is ticked, Date must be empty (and will be disabled)
    if (checkedCount >= 1 && dateField && dateField.value) {
      alert(`❌ ${label}: Date must be EMPTY when an Attempt is ticked.`);
      event.preventDefault();
      return;
    }
  }
});

// Auto-fill today's date in Declaration Date field
document.addEventListener("DOMContentLoaded", function() {
  const dateField = document.getElementById("declaration_date");
  if (dateField) {
    const today = new Date();
    const yyyy = today.getFullYear();
    const mm = String(today.getMonth() + 1).padStart(2, '0');
    const dd = String(today.getDate()).padStart(2, '0');
    dateField.value = `${yyyy}-${mm}-${dd}`;
  }
});

// --- Auto-count total number of exams ---
function updateTotalExams() {
  let total = 0;
  for (const [key, label] of subjects) {
    const attempts = Array.from(document.querySelectorAll(
      `input[name='${key}_attempt1'], input[name='${key}_attempt2'], input[name='${key}_attempt3'], input[name='${key}_attempt4']`
    ));
    // Count 1 subject if at least one Attempt is ticked
    if (attempts.some(cb => cb.checked)) {
      total++;
    }
  }
  const totalField = document.getElementById("total_exams");
  if (totalField) totalField.value = total;
}

// Attach update listener to all attempt checkboxes
document.querySelectorAll("input[type='checkbox']").forEach(cb => {
  cb.addEventListener("change", updateTotalExams);
});

// Run once on page load
updateTotalExams();

</script>

</body>
</html>
